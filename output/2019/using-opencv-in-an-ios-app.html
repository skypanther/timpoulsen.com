
<!DOCTYPE html>
<html lang="en">
<head>
  <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,400italic' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" type="text/css" href="../theme/stylesheet/style.min.css">

  <link rel="stylesheet" type="text/css" href="../theme/pygments/github.min.css">
  <link rel="stylesheet" type="text/css" href="../theme/css/main.css">
  <link rel="stylesheet" type="text/css" href="../theme/font-awesome/css/font-awesome.min.css">

    <link href="https://www.timpoulsen.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Tim Poulsen Atom">


  <link rel="apple-touch-icon" sizes="57x57" href="/images/favicons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/images/favicons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/images/favicons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/images/favicons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/images/favicons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/images/favicons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/images/favicons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/images/favicons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="/images/favicons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/images/favicons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicons/favicon-16x16.png">
  <link rel="manifest" href="/images/favicons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/images/favicons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="index, follow" />

    <!-- Chrome, Firefox OS and Opera -->
    <meta name="theme-color" content="#143742">
    <!-- Windows Phone -->
    <meta name="msapplication-navbutton-color" content="#143742">
    <!-- iOS Safari -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<meta name="author" content="Tim Poulsen" />
<meta name="description" content="Computer vision is cool tech ... computer vision in an iOS app is even better! In this post, I'll describe how you can integrate and use OpenCV in your Swift-based iOS app. Before we dig in to the process, let's take a look at how the finished integration will work. As …" />
<meta name="keywords" content="OpenCV, iOS, Swift">
<meta property="og:site_name" content="Tim Poulsen"/>
<meta property="og:title" content="Using OpenCV in an iOS app"/>
<meta property="og:description" content="Computer vision is cool tech ... computer vision in an iOS app is even better! In this post, I'll describe how you can integrate and use OpenCV in your Swift-based iOS app. Before we dig in to the process, let's take a look at how the finished integration will work. As …"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="../2019/using-opencv-in-an-ios-app.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2019-02-01 00:00:00-05:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="../author/tim-poulsen.html">
<meta property="article:section" content="OpenCV"/>
<meta property="article:tag" content="OpenCV"/>
<meta property="article:tag" content="iOS"/>
<meta property="article:tag" content="Swift"/>
<meta property="og:image" content="/images/tim_poulsen.jpg">

  <title>Tim Poulsen &ndash; Using OpenCV in an iOS app</title>


    <link href="/theme/css/main.css" rel="stylesheet">

</head>
<body>
  <aside class="leftbar" style="background-color: #030E36;">
    <div class="leftbar" style="background-color: #030E36;">
      <a href="..">
        <img src="/images/tim_poulsen.jpg" alt="Tim Poulsen" title="Tim Poulsen">
      </a>
      <h1><a href="..">Tim Poulsen</a></h1>

<p class="subtitle">Explorations of software and hardware</p>
      <ul class="social">
        <li><a class="sc-twitter" href="https://twitter.com/skypanther" target="_blank"><i class="fa fa-twitter"></i></a></li>
        <li><a class="sc-github" href="https://github.com/skypanther" target="_blank"><i class="fa fa-github"></i></a></li>
        <li><a class="sc-linkedin" href="https://www.linkedin.com/in/timpoulsen" target="_blank"><i class="fa fa-linkedin"></i></a></li>
        <li><a class="sc-rss" href="feeds/all.atom.xml" target="_blank"><i class="fa fa-rss"></i></a></li>
      </ul>

      <nav>
        <ul class="list">
          <li><a href="../pages/about.html#about">About</a></li>

          <li><a href="/categories.html" target="_blank">Topics</a></li>
          <li><a href="http://skypanther.com" target="_blank">Skypanther Studios</a></li>
        </ul>
      </nav>

      <p class="subhead">Tags:</p>
      <ul class="tagcloud">
          <li class="tag-1">
              <a href="../tag/python.html">
              python
              </a>
          </li>
          <li class="tag-1">
              <a href="../tag/opencv.html">
              opencv
              </a>
          </li>
          <li class="tag-2">
              <a href="../tag/raspberry-pi.html">
              raspberry pi
              </a>
          </li>
          <li class="tag-2">
              <a href="../tag/making.html">
              making
              </a>
          </li>
          <li class="tag-3">
              <a href="../tag/robotics.html">
              robotics
              </a>
          </li>
          <li class="tag-4">
              <a href="../tag/ios.html">
              iOS
              </a>
          </li>
          <li class="tag-4">
              <a href="../tag/swift.html">
              Swift
              </a>
          </li>
          <li class="tag-4">
              <a href="../tag/anaconda.html">
              anaconda
              </a>
          </li>
      </ul>

    </div>


  </aside>
  <main>

    <nav>
      <a href="..">    Home
</a>

      <a href="/categories.html">Topics</a>
      <a href="/pages/about.html">About</a>
      <a href="/tags.html">Tags</a>

      <a href="https://www.timpoulsen.com/feeds/all.atom.xml">    Atom
</a>

    </nav>

<article class="single">
  <header>
    <h1 id="using-opencv-in-an-ios-app">Using OpenCV in an iOS app</h1>
    <p>
          Posted on Fri 01 February 2019 in <a href="../category/opencv.html">OpenCV</a>


    </p>
  </header>


  <div>
    <p>Computer vision is cool tech ... computer vision in an iOS app is even better! In this post, I'll describe how you can integrate and use OpenCV in your Swift-based iOS app. Before we dig in to the process, let's take a look at how the finished integration will work.</p>
<p><img alt="Integration diagram" src="../images/2019/ios_opencv.png"></p>
<p>As shown in the diagram, you will continue to write most of your app in Swift as you normally would do. The OpenCV framework will be included in your app, inside a wrapper that you'll write. A bridging header will connect your Swift code to the Objective-C / C++ code of OpenCV. (You'll also add a prefix/precompile header to optimize build times.)</p>
<p>Once you've set all that up, you'll be able to make use of OpenCV with Swift code like:</p>
<div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nv">edged</span><span class="p">:</span> <span class="bp">UIImage</span> <span class="p">=</span> <span class="n">OpenCVWrapper</span><span class="p">.</span><span class="n">detectEdges</span><span class="p">(</span><span class="n">inRGBImage</span><span class="p">:</span> <span class="n">your_image</span><span class="p">)</span>
</pre></div>


<p>But we're jumping ahead. There are a few steps to go through to get this all setup. Let's get OpenCV integrated and then I'll go through some usage examples.</p>
<h2>Integration overview</h2>
<p>At a high-level, you'll need to perform the following steps:</p>
<ol>
<li>Add the OpenCV framework to your project</li>
<li>Create the wrapper</li>
<li>Create a bridging header</li>
<li>Create a prefix header</li>
<li>Implement the OpenCV functionality you need</li>
<li>Use those methods from Swift</li>
</ol>
<p>Let's dive in.</p>
<h2>Integration steps</h2>
<p>First, download and unzip the OpenCV pack:</p>
<ol>
<li>Go to <a href="https://opencv.org/releases.html">https://opencv.org/releases.html</a></li>
<li>Find 3.4.4 (or other suitable version) and click the <strong>iOS pack</strong> link</li>
<li>Unzip the file to a convenient temporary location</li>
</ol>
<p>Next, either create or open your Xcode project. You'll want to arrange Xcode and Finder side-by-side and then drag the <strong>opencv2.framework</strong> bundle (special folder) into the Xcode project tree, at the top level, to add it to your project. Note:</p>
<ul>
<li>Make sure <strong>Copy items if needed</strong> is checked</li>
<li>Make sure <strong>Create folder references</strong> is checked</li>
<li>Make sure <strong>Add to targets: <em>your_project</em></strong> is checked</li>
</ul>
<p><img alt="OpenCV framework file in the Xcode file tree" src="../images/2019/opencv_framework.png"></p>
<p>You can close Finder at this point. We'll work in Xcode for the rest of this. Next, we need to create the wrapper around OpenCV. In doing so, we'll also create the bridging header.</p>
<ol>
<li>Choose File &gt; New &gt; File</li>
<li>Create a <strong>Cocoa Touch Class</strong> file, naming it <em>OpenCVWrapper</em> (or another name if you prefer)</li>
<li>It should subclass <strong>NSOBject</strong></li>
<li>It should be an <strong>Objective-C</strong> file</li>
<li>When prompted, click the <strong>Create Bridging Header</strong> button</li>
</ol>
<p>Open the <em>YourApp</em>-Bridging-Header.h file and add this line:</p>
<div class="highlight"><pre><span></span><span class="c1">#import &quot;OpenCVWrapper.h&quot;</span>
</pre></div>


<p>That's all you'll need to do inside your bridging header. With this simple file in place, you've created a <em>bridge</em> between Objective-C (where you'll write the actual OpenCV code) and Swift (where you'll use it).</p>
<p>Next, we need to make a couple of changes to the OpenCVWrapper.m file. First, change the name of the OpenCVWrapper.m file to <strong>OpenCVWrapper.mm</strong>. Doing so informs Xcode to treat it as a C++ rather than C file. Then, inside that file, make sure the imports at the top are in this order. If you don't, you will get weird compile errors later.</p>
<div class="highlight"><pre><span></span><span class="c1">#import &lt;opencv2/opencv.hpp&gt;</span>
<span class="c1">#import &quot;OpenCVWrapper.h&quot;</span>
</pre></div>


<p>Finally, we need to set up the prefix header. Again, there's not much that you'll need to do with this file. It will simply tell Xcode to not recompile the already-compiled OpenCV framework to speed up your builds.</p>
<ol>
<li>Choose File &gt; New &gt; File</li>
<li>Scroll to near the bottom and choose <strong>PCH File</strong></li>
<li>Make sure your app is checked in the Targets list</li>
<li>Click Create</li>
</ol>
<p>Inside the prefix header, before the closing <code>#endif</code> statement, add:</p>
<div class="highlight"><pre><span></span><span class="cp">#ifdef __cplusplus</span>
<span class="cp">#include</span> <span class="cpf">&lt;opencv2/opencv.hpp&gt;</span><span class="cp"></span>
<span class="cp">#endif</span>
</pre></div>


<p>That is, you're done! Well, you can build the app now and OpenCV is integrated. Of course you've done nothing to implement OpenCV's functions yet. (By the way, you'll get many OpenCV-related build warnings which you can safely ignore. They mostly relate to inline documentation comments being in the wrong format and won't affect your app's execution in any way.)</p>
<h2>Implementing an OpenCV function</h2>
<p>The basic steps you'll follow to implement an OpenCV function and use it in your app are:</p>
<ol>
<li>Add the function signature to the OpenCVWrapper.h file</li>
<li>Add the function's implementation code in the OpenCVWrapper.mm file</li>
<li>Call that function in your Swift file</li>
</ol>
<p>For example, your .h header declares the function and its signature, which might look like this:</p>
<div class="highlight"><pre><span></span><span class="cp">#import &lt;Foundation/Foundation.h&gt;</span>

<span class="n">NS_ASSUME_NONNULL_BEGIN</span>

<span class="err">@</span><span class="n">interface</span> <span class="nl">OpenCVWrapper</span> <span class="p">:</span> <span class="n">NSObject</span>

<span class="o">+</span> <span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="n">openCVVersionString</span><span class="p">;</span>

<span class="err">@</span><span class="n">end</span>

<span class="n">NS_ASSUME_NONNULL_END</span>
</pre></div>


<p>Your .mm file would have the corresponding function implementation:</p>
<div class="highlight"><pre><span></span><span class="cp">#import &lt;opencv2/opencv.hpp&gt;</span>
<span class="cp">#import &quot;OpenCVWrapper.h&quot;</span>

<span class="err">@</span><span class="n">implementation</span> <span class="n">OpenCVWrapper</span>

<span class="o">+</span> <span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="n">openCVVersionString</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">NSString</span> <span class="nl">stringWithFormat</span><span class="p">:</span><span class="err">@</span><span class="s">&quot;OpenCV Version %s&quot;</span><span class="p">,</span>  <span class="n">CV_VERSION</span><span class="p">];</span>
<span class="p">}</span>

<span class="err">@</span><span class="n">end</span>
</pre></div>


<p>Per Objective-C syntax, the <code>+</code> indicates a class method; use <code>-</code> to indicate an instance method. The difference is probably inconsequential since there will only ever be one instance of your OpenCVWrapper class. So, you can probably use <code>+</code> to prefix all of your functions as shown above.</p>
<p>OK, so let's use this powerful new OpenCV capability. In your main ViewController.swift file, update <strong>viewDidLoad</strong> to call that new function:</p>
<div class="highlight"><pre><span></span><span class="kr">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
    <span class="kc">super</span><span class="p">.</span><span class="n">viewDidLoad</span><span class="p">()</span>
    <span class="bp">print</span><span class="p">(</span><span class="s">&quot;</span><span class="si">\(</span><span class="n">cv2</span><span class="p">.</span><span class="n">openVersionString</span><span class="si">())</span><span class="s">&quot;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>


<p>Build to a simulator and watch the Xcode debug console and you should see <code>OpenCV Version 3.4.4</code> there. Congratulations, you've integrated OpenCV into your iOS app.</p>
<h2>A better example</h2>
<p>I've created a simple project so that you can explore something a little more meaningful. This app lets you take a picture (so you'll need to run it on a device) and then apply some OpenCV manipulations. </p>
<ol>
<li><a href="../images/2019/OpenCVTest.zip">Download the OpenCVTest Xcode project</a>. </li>
<li>Update the project properties with your organization / app-signing profile.</li>
<li>Download and drag the <strong>opencv2.framework</strong> bundle into the Xcode project tree (it's too big to include in my zip file). I used OpenCV 3.4.4 and any of the 3.x version should work. But I haven't tested with 4.x, so YMMV.</li>
<li>Build the app to a device. The app should be fairly self-explantory.</li>
</ol>
<p>Make sure to explore the <code>.h</code> and <code>.mm</code> files, as well as the <code>ProcessImageController.swift</code> file in this project. Also check out the UIImage extension. Together, these should give you a good start on writing your own OpenCV functionality.</p>
<h2>Closing thoughts</h2>
<p>You'll need to write your OpenCV code in Objective-C (that's what's in the <code>.mm</code> file). But as best as I can tell, there is no specific OpenCV-for-iOS documentation. For the most part, any C++ OpenCV sample code you find will work without much modification. From there, I'm sorry to say you'll have to turn to StackOverflow and Google and hope.</p>
<p>I've found OpenCV's functions to be typically much faster than the equivalent Swift implementations. For example, converting an image to grayscale is considerably faster with OpenCV. But test, because some OpenCV operations are slower, sometimes surprisingly so. Blurring an image, for example, is many times faster in Swift than in OpenCV.</p>
<p>But, avoid passing images back-and-forth between Swift and OpenCV. You'll need to change data formats (e.g. from OpenCV Mat to UIImage or CIImage) which can be quite slow and you may encounter memory leaks. Instead, do all the processing you can in one layer or the other and pass only the final result between layers.</p>
<p>Images you capture from an iPhone (and presumably iPad) camera can be appear to be turned upside-down by OpenCV. In fact, it's just a different way of handling the orientation information in the files. Check out the UIImage extension that I've included in the sample project above. As you'll see in that project, you can get a correctly oriented portrait image by simply accessing the <em>normalized</em> property of the image, like this: <code>OpenCVWrapper.convert(toGrayscale: img.normalized!)</code></p>
<p>Good luck and have fun building great OpenCV vision-enabled iOS apps!</p>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="../tag/opencv.html">OpenCV</a>
      <a href="../tag/ios.html">iOS</a>
      <a href="../tag/swift.html">Swift</a>
    </p>
  </div>




</article>

    <footer>
<p>
  &copy; Tim Poulsen 2019 - This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>
</p>
<p>    Powered by <a href="http://getpelican.com" target="_blank">Pelican</a> - <a href="https://github.com/alexandrevicenzi/flex" target="_blank">Flex</a> theme by <a href="http://alexandrevicenzi.com" target="_blank">Alexandre Vicenzi</a>
</p><p>
  <a rel="license"
     href="http://creativecommons.org/licenses/by-sa/4.0/"
     target="_blank">
    <img alt="Creative Commons License"
         title="Creative Commons License"
         style="border-width:0"
         src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png"
         width="80"
         height="15"/>
  </a>
</p>    </footer>
  </main>





<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Tim Poulsen ",
  "url" : "..",
  "image": "/images/tim_poulsen.jpg",
  "description": "Tim Poulsen's blog of software, hardware, and life"
}
</script>
</body>
</html>