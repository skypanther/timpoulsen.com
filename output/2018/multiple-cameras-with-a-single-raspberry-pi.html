
<!DOCTYPE html>
<html lang="en">
<head>
  <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,400italic' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" type="text/css" href="../theme/stylesheet/style.min.css">

  <link rel="stylesheet" type="text/css" href="../theme/pygments/github.min.css">
  <link rel="stylesheet" type="text/css" href="../theme/css/main.css">
  <link rel="stylesheet" type="text/css" href="../theme/font-awesome/css/fontawesome.css">


    <link href="https://www.timpoulsen.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Tim Poulsen Atom">


  <link rel="apple-touch-icon" sizes="57x57" href="/images/favicons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/images/favicons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/images/favicons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/images/favicons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/images/favicons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/images/favicons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/images/favicons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/images/favicons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="/images/favicons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/images/favicons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicons/favicon-16x16.png">
  <link rel="manifest" href="/images/favicons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/images/favicons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="index, follow" />

    <!-- Chrome, Firefox OS and Opera -->
    <meta name="theme-color" content="#143742">
    <!-- Windows Phone -->
    <meta name="msapplication-navbutton-color" content="#143742">
    <!-- iOS Safari -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<meta name="author" content="Tim Poulsen" />
<meta name="description" content="The Arducam Multi Camera Adapter board is a neat accessory for a Raspberry Pi. With it, you can connect multiple cameras to a single Pi. A single board supports up to four cameras. According to Arducam, you can stack up to four boards for a total of 16 cameras on …" />
<meta name="keywords" content="python, raspberry pi, making">
<meta property="og:site_name" content="Tim Poulsen"/>
<meta property="og:title" content="Multiple cameras with a single Raspberry Pi"/>
<meta property="og:description" content="The Arducam Multi Camera Adapter board is a neat accessory for a Raspberry Pi. With it, you can connect multiple cameras to a single Pi. A single board supports up to four cameras. According to Arducam, you can stack up to four boards for a total of 16 cameras on …"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="../2018/multiple-cameras-with-a-single-raspberry-pi.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2018-09-02 00:00:00-04:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="../author/tim-poulsen.html">
<meta property="article:section" content="Python"/>
<meta property="article:tag" content="python"/>
<meta property="article:tag" content="raspberry pi"/>
<meta property="article:tag" content="making"/>
<meta property="og:image" content="/images/tim_poulsen.jpg">

  <title>Tim Poulsen &ndash; Multiple cameras with a single Raspberry Pi</title>


    <link href="/theme/css/main.css" rel="stylesheet">

</head>
<body>
  <aside class="leftbar" style="background-color: #030E36;">
    <div class="leftbar" style="background-color: #030E36;">
      <a href="..">
        <img src="/images/tim_poulsen.jpg" alt="Tim Poulsen" title="Tim Poulsen">
      </a>
      <h1><a href="..">Tim Poulsen</a></h1>

<p class="subtitle">Explorations of software and hardware</p>
      <ul class="social">
        <li><a class="sc-twitter" href="https://twitter.com/skypanther" target="_blank"><i class="fa fa-twitter"></i></a></li>
        <li><a class="sc-github" href="https://github.com/skypanther" target="_blank"><i class="fa fa-github"></i></a></li>
        <li><a class="sc-linkedin" href="https://www.linkedin.com/in/timpoulsen" target="_blank"><i class="fa fa-linkedin"></i></a></li>
        <li><a class="sc-keybase" href="https://keybase.io/skypanther" target="_blank"><i class="fa fa-keybase"></i></a></li>
        <li><a class="sc-rss" href="feeds/all.atom.xml" target="_blank"><i class="fa fa-rss"></i></a></li>
      </ul>

      <nav>
        <ul class="list">
          <li><a href="../pages/about.html#about">About</a></li>

          <li><a href="/categories.html" target="_blank">Topics</a></li>
          <li><a href="http://skypanther.com" target="_blank">Skypanther Studios</a></li>
        </ul>
      </nav>

      <p class="subhead">Tags:</p>
      <ul class="tagcloud">
          <li class="tag-1">
              <a href="../tag/python.html">
              python
              </a>
          </li>
          <li class="tag-1">
              <a href="../tag/opencv.html">
              opencv
              </a>
          </li>
          <li class="tag-2">
              <a href="../tag/raspberry-pi.html">
              raspberry pi
              </a>
          </li>
          <li class="tag-2">
              <a href="../tag/making.html">
              making
              </a>
          </li>
          <li class="tag-3">
              <a href="../tag/robotics.html">
              robotics
              </a>
          </li>
          <li class="tag-4">
              <a href="../tag/htmlcss.html">
              html/css
              </a>
          </li>
          <li class="tag-4">
              <a href="../tag/webdev.html">
              webdev
              </a>
          </li>
          <li class="tag-4">
              <a href="../tag/arduino.html">
              arduino
              </a>
          </li>
          <li class="tag-4">
              <a href="../tag/xmas.html">
              xmas
              </a>
          </li>
          <li class="tag-4">
              <a href="../tag/ios.html">
              iOS
              </a>
          </li>
          <li class="tag-4">
              <a href="../tag/swift.html">
              Swift
              </a>
          </li>
          <li class="tag-4">
              <a href="../tag/anaconda.html">
              anaconda
              </a>
          </li>
      </ul>

    </div>


  </aside>
  <main>

    <nav>
      <a href="..">    Home
</a>

      <a href="/categories.html">Topics</a>
      <a href="/pages/about.html">About</a>
      <a href="/tags.html">Tags</a>

      <a href="https://www.timpoulsen.com/feeds/all.atom.xml">    Atom
</a>

    </nav>

<article class="single">
  <header>
    <h1 id="multiple-cameras-with-a-single-raspberry-pi">Multiple cameras with a single Raspberry Pi</h1>
    <p>
          Posted on Sun 02 September 2018 in <a href="../category/python.html">Python</a>


    </p>
  </header>


  <div>
    <p>The Arducam Multi Camera Adapter board is a neat accessory for a Raspberry Pi. With it, you can connect multiple cameras to a single Pi. A single board supports up to four cameras. According to Arducam, you can stack up to four boards for a total of 16 cameras on a single Pi.</p>
<p><img alt="Arducam Multicamera Adapter" src="../images/2018/arducam.jpg"></p>
<p>I had a chance to use a couple of these boards in a recent project. Our goal was to capture multiple images to form an image mosaic. My setup included a Raspberry Pi 3B+, two of the Arducam multicamera boards, and six cameras. (Only the 5MP v1 Pi cameras, or Arducam's 5MP camera are supported, not the 8MP v2 camera.)</p>
<p>Since Arducam's documentation is sparse, I thought I'd share my experiences with this adapter as well as a Python library I wrote that simplifies accessing each of the cameras.</p>
<p>First, you should know that you cannot capture the images simultaneously. The adapter works by enabling one camera at a time. So, you can take photos one after the other, but there will be a small delay between each. Arducam does not specify how long it takes to switch between cameras. Our code pauses for 0.1 second between photos though we could probably wait less time than that.</p>
<h2>Hardware setup</h2>
<p>Let's start with the hardware side. The adapter board will use 26 of the GPIO pins of the Pi, leaving you the last 14 pins free for other purposes. You will connect the Pi's camera port (called the CSI port) to the adapter board with a ribbon cable. Then, you'll connect the CSI cable from each of your cameras to the ports on the adapter. </p>
<p>Key hardware setup points:</p>
<ul>
<li>Connect the Arducam board starting with GPIO pin 1</li>
<li>Connect the Pi's CSI port to the Arducam board, pin side of the ribbon towards the board (blue/tape side up)</li>
<li>Connect camera CSI cables to the Arducam board, pin side of the ribbon towards the board (blue/tape side up)</li>
<li>It does not matter whether you connect the cameras in order (to port A, then B, etc.) though it will matter for your code</li>
</ul>
<h3>Stacking multiple boards</h3>
<p>How about stacking multiple boards? You'll need to solder on the 10-pin connector that Arducam supplies to each of the adapters. These are the high-speed MSI bus over which the camera data is transferred between boards. Because of this connector, the bottom adapter didn't sit straight on my Pi3B+ since the connector hits the HDMI connector. </p>
<p>You'll need to set DIP switches on the boards to identify which of the OE (output enable) pins that board will use. For board 1, switches 1 and 5 must be on and the rest off. For board 2, switches 2 and 6 are on. See the <a href="http://www.arducam.com/multi-camera-adapter-module-raspberry-pi/" target="_blank">Arducam site</a> for the full list. </p>
<p><img alt="DIP switches" src="../images/2018/arducam_dip_switches.jpg"></p>
<p>Pictures on the Amazon listing for the adapter shows the CSI cable going between the bottom board to the Pi. In their emails to me, Arducam suggested connecting the ribbon cable to the top-most board. (It made no difference for me where it was connected.)</p>
<h2>Software</h2>
<p>With that hardware setup out of the way, let's move onto the software side of things. </p>
<h3>Channels and ports</h3>
<p>The adapter enables multiple camera support by providing two channels, each with two camera ports. You select which camera to use by enabling one of the channels and one of the camera ports. You do so by setting certain GPIO pins high or low.</p>
<p>Arducam calls these the channel select (CS) and output enable (OE) pins. All of the stacked boards share the same CS pin but have their own OE pins (hence the DIP switches you must set). There's a listing of which pins you must set on the <a href="http://www.arducam.com/multi-camera-adapter-module-raspberry-pi/" target="_blank">Arducam site</a>, though my library hides that complexity.</p>
<h3>Caveat</h3>
<p>I must point out that I couldn't get stacked adapters to work. Even after multiple emails back and forth with Arducam, connecting a second adapter would cause my Pi to crash as soon as I tried accessing any camera. So, while my library supports up to 16 cameras, I can only be sure it works with four.</p>
<h3>The multicam library</h3>
<p>I have not published the library to PyPI (and probably won't). Instead, I've put it on <a href="https://gist.github.com/skypanther/04b44eaa455f358eb70e59336c068312">a GitHub Gist</a>. Using it is pretty simple, though it has a couple of dependencies.</p>
<ul>
<li><a href="https://pythonhosted.org/RPIO/">RPi.GPIO</a> - installed by default in Raspbian Stretch (full version)</li>
<li><a href="https://picamera.readthedocs.io/en/release-1.13/index.html">PiCamera</a> - install with <code>pip install picamera</code></li>
</ul>
<p>Because my project used OpenCV, by default, my library returns captured photos as an OpenCV "BGR" formatted blob. You can pass the <code>image_format</code> param to the capture method if you want to use another format. Any format <a href="https://picamera.readthedocs.io/en/release-1.13/api_camera.html#picamera.PiCamera.capture">supported by PiCamera's <code>capture</code> method</a> will work.</p>
<p>OpenCV is not installed by default, check out <a href="https://www.pyimagesearch.com/2017/09/04/raspbian-stretch-install-opencv-3-python-on-your-raspberry-pi/">PyImageSearch's tutorial</a> for install instructions if you want to use OpenCV on your Pi.</p>
<h3>Examples</h3>
<p>Using OpenCV, a minimal example follows:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">cv2</span>
<span class="kn">from</span> <span class="nn">multicam</span> <span class="kn">import</span> <span class="n">Multicam</span>

<span class="n">mcam</span> <span class="o">=</span> <span class="n">Multicam</span><span class="p">()</span>

<span class="n">img</span> <span class="o">=</span> <span class="n">mcam</span><span class="o">.</span><span class="n">capture</span><span class="p">(</span><span class="n">cam</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;Cam A&#39;</span><span class="p">,</span> <span class="n">img</span><span class="p">)</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">mcam</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span>
</pre></div>
</td></tr></table>

<p>Or, with Matplotlib, you just need to specify the <code>rgb</code> image format:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">multicam</span> <span class="kn">import</span> <span class="n">Multicam</span>

<span class="n">mcam</span> <span class="o">=</span> <span class="n">Multicam</span><span class="p">()</span>

<span class="n">img</span> <span class="o">=</span> <span class="n">mcam</span><span class="o">.</span><span class="n">capture</span><span class="p">(</span><span class="n">cam</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">image_format</span><span class="o">=</span><span class="s1">&#39;rgb&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">set_window_title</span><span class="p">(</span><span class="s1">&#39;Cam A&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">mcam</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span>
</pre></div>
</td></tr></table>

<p>Of course, you could do the above with a single camera. Where this library shines is of course accessing the other cameras:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">cv2</span>
<span class="kn">from</span> <span class="nn">multicam</span> <span class="kn">import</span> <span class="n">Multicam</span>

<span class="n">mcam</span> <span class="o">=</span> <span class="n">Multicam</span><span class="p">()</span>

<span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;Cam A&#39;</span><span class="p">,</span> <span class="n">mcam</span><span class="o">.</span><span class="n">capture</span><span class="p">(</span><span class="n">cam</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">))</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;Cam B&#39;</span><span class="p">,</span> <span class="n">mcam</span><span class="o">.</span><span class="n">capture</span><span class="p">(</span><span class="n">cam</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">))</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;Cam C&#39;</span><span class="p">,</span> <span class="n">mcam</span><span class="o">.</span><span class="n">capture</span><span class="p">(</span><span class="n">cam</span><span class="o">=</span><span class="s1">&#39;c&#39;</span><span class="p">))</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;Cam D&#39;</span><span class="p">,</span> <span class="n">mcam</span><span class="o">.</span><span class="n">capture</span><span class="p">(</span><span class="n">cam</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">))</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">mcam</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span>
</pre></div>
</td></tr></table>

<p>There's no need to worry about setting GPIO pins, selecting channels, etc. The library does all that for you. If you have multiple adapters stacked, you can keep going (up to camera 16, or "p")</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">cv2</span>
<span class="kn">from</span> <span class="nn">multicam</span> <span class="kn">import</span> <span class="n">Multicam</span>

<span class="n">mcam</span> <span class="o">=</span> <span class="n">Multicam</span><span class="p">()</span>

<span class="c1"># Camera 5  </span>
<span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;Cam E&#39;</span><span class="p">,</span> <span class="n">mcam</span><span class="o">.</span><span class="n">capture</span><span class="p">(</span><span class="n">cam</span><span class="o">=</span><span class="s1">&#39;e&#39;</span><span class="p">))</span>
<span class="c1"># Camera 16</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;Cam P&#39;</span><span class="p">,</span> <span class="n">mcam</span><span class="o">.</span><span class="n">capture</span><span class="p">(</span><span class="n">cam</span><span class="o">=</span><span class="s1">&#39;p&#39;</span><span class="p">))</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">mcam</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span>
</pre></div>
</td></tr></table>

<h3>Notes and miscellaneous</h3>
<p>Each of the above examples ends with a call to <code>cleanup</code>. This releases the GPIO ports. You should always call this function at the end of your script to avoid errors if you re-run the script (without restarting the Pi).</p>
<p>By default, my library uses "board" port assignments. This means GPIO ports are accessed according to their physical pin number. This use matches the examples on the Arducam site.</p>
<p>However, some libraries, like <a href="https://gpiozero.readthedocs.io/en/stable/index.html">gpiozero</a>, are limited to using the Broadcom numbering scheme. If you're using such a library, you can tell the multicam library to use "bcm" numbering during initialization:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">multicam</span> <span class="kn">import</span> <span class="n">Multicam</span>

<span class="n">mcam</span> <span class="o">=</span> <span class="n">Multicam</span><span class="p">(</span><span class="n">gpio_mode</span><span class="o">=</span><span class="s1">&#39;bcm&#39;</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<h2>Conclusion</h2>
<p>If you buy one of these boards, grab a copy of <a href="https://gist.github.com/skypanther/04b44eaa455f358eb70e59336c068312">my multicam library</a> to ease working with the cameras. Please comment on that Gist if you find issues. It's MIT licensed so free to use in any of your projects.</p>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="../tag/python.html">python</a>
      <a href="../tag/raspberry-pi.html">raspberry pi</a>
      <a href="../tag/making.html">making</a>
    </p>
  </div>




</article>

    <footer>
<p>
  &copy; Tim Poulsen 2020 - This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>
</p>
<p>    Powered by <a href="http://getpelican.com" target="_blank">Pelican</a> - <a href="https://github.com/alexandrevicenzi/flex" target="_blank">Flex</a> theme by <a href="http://alexandrevicenzi.com" target="_blank">Alexandre Vicenzi</a>
</p><p>
  <a rel="license"
     href="http://creativecommons.org/licenses/by-sa/4.0/"
     target="_blank">
    <img alt="Creative Commons License"
         title="Creative Commons License"
         style="border-width:0"
         src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png"
         width="80"
         height="15"/>
  </a>
</p>    </footer>
  </main>





<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Tim Poulsen ",
  "url" : "..",
  "image": "/images/tim_poulsen.jpg",
  "description": "Tim Poulsen's blog of software, hardware, and life"
}
</script>
</body>
</html>